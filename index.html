<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="css/style.css">


    <script src="lib/glMatrix-0.9.5.min.js"></script>
    <script type='text/javascript' src='./lib/webgl-obj-loader.js'></script>


    <!-- jquery -->
    <script src="./lib/jquery.js"></script>

    <!-- MIDI -->
    <script src="./lib/jasmid/replayer.js"></script>
    <script src="./lib/jasmid/midifile.js"></script>
    <script src="./lib/jasmid/stream.js"></script>

    <script src="./lib/midi/MIDI/MIDI.js"></script>
    <script src="./lib/midi/Window/DOMLoader.script.js"></script>

    <script src="./lib/midi/inc/Base64.js"></script>
    <script src="./lib/midi/inc/base64binary.js"></script>



    <!-- Own sources -->


    <script src="./js/midi.js"></script>
    <script src="js/core.js" type="text/javascript"></script>
    <!-- <script type="text/javascript" src="./js/index.js"></script> -->



    <!-- Fragment shader program -->
    <script id="triangle-shader-fs" type="x-shader/x-fragment">
		    // set medium percision
		    precision mediump float;

		    // uniform attribute for setting the color
		    varying vec4 vColor;
			// spremenljivka se prenese iz vertex shaderja v fragment shader
			// in se interpolira iz natancnosti za vsako vozlisce v natancnost za vsak pixel

		    void main(void) {
	        	// Setting color of fragments to input color
		        gl_FragColor = vColor;
		    }

    </script>

        <!-- Fragment shader program for tunnel -->
    <script id="tunnel-shader-fs" type="x-shader/x-fragment">


        precision mediump float;

            // uniform attribute for setting texture coordinates
            varying vec2 vTextureCoord;
            // uniform attribute for setting normals
            varying vec3 vTransformedNormal;
            // uniform attribute for setting positions
            varying vec4 vPosition;

            // uniform attribute for setting shininess
            uniform float uMaterialShininess;

            // uniform attribute for enabling speculars
//          uniform bool uShowSpecularHighlights;

            // uniform attribute for enabling lighting
//          uniform bool uUseLighting;

            // uniform attribute for enabling textures
//          uniform bool uUseTextures;

            uniform vec3 uAmbientColor; // ambient color uniform

            uniform vec3 uPointLightingLocation;            // light direction uniform
            uniform vec3 uPointLightingSpecularColor;       // specular light color
            uniform vec3 uPointLightingDiffuseColor;        // difuse light color

            // uniform attribute for setting 2D sampler
            uniform sampler2D uSampler;


            void main(void) {
                vec3 lightWeighting;

                vec3 lightDirection = normalize(uPointLightingLocation - vPosition.xyz);
                vec3 normal = normalize(vTransformedNormal);

                // Specular component
                float specularLightWeighting = 0.0;
                vec3 eyeDirection = normalize(-vPosition.xyz);
                vec3 reflectionDirection = reflect(-lightDirection, normal);

                specularLightWeighting = pow(max(dot(reflectionDirection, eyeDirection), 0.0), uMaterialShininess);


                // diffuese component
                float diffuseLightWeighting = max(dot(normal, lightDirection), 0.0);
                lightWeighting = uAmbientColor
                    + uPointLightingSpecularColor * specularLightWeighting
                    + uPointLightingDiffuseColor * diffuseLightWeighting;


                vec4 fragmentColor;
                // sample the fragment color from texture
                // fragmentColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));

                // fixed color
                fragmentColor = vec4(1.0, 1.0, 1.0, 1.0);

                // sample the fragment color from texture
                gl_FragColor = vec4(fragmentColor.rgb * lightWeighting, fragmentColor.a);
            }


    </script>


    <!-- Vertex shader program -->
    <script id="triangle-shader-vs" type="x-shader/x-vertex">
    		// atributes for setting vertex position and color
		    attribute vec3 aVertexPosition;
		    attribute vec4 aVertexColor; // barva

		    uniform mat4 uMVMatrix;	// model-view matrix
		    uniform mat4 uPMatrix;	// projection matrix

		    varying vec4 vColor;	// variable for passing color value to the fragment shader

			// bilinearna interpolacija
			// iz vertexov -> na piksle
			// ubistvu se to zgodi pri rasterizaciji


		    void main(void) {
		    	// calculate the vertex position
		        gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);
		        vColor = aVertexColor;
		    }

    </script>

    <!-- Vertex shader program for tunnel -->
    <script id="tunnel-shader-vs" type="x-shader/x-vertex">
        // atributes for setting vertex position, normals and texture coordinates
            attribute vec3 aVertexPosition;
            attribute vec3 aVertexNormal;
            attribute vec2 aTextureCoord;

            uniform mat4 uMVMatrix; // model-view matrix
            uniform mat4 uPMatrix;  // projection matrix
            uniform mat3 uNMatrix;  // normal matrix

            // variable for passing texture coordinates and lighting weights
            // from vertex shader to fragment shader
            varying vec2 vTextureCoord;
            varying vec3 vTransformedNormal;
            varying vec4 vPosition;


            void main(void) {
                // calculate the vertex position
                vPosition = uMVMatrix * vec4(aVertexPosition, 1.0);
                gl_Position = uPMatrix * vPosition;
                vTextureCoord = aTextureCoord;
                vTransformedNormal = uNMatrix * aVertexNormal;
            }
    </script>


</head>

<body onkeypress="checkPressedKey(event)">
<!-- no more onload="start()" because of window.onload in js -->


<span>
    Load MIDI file:
    <input type="file" id="file_upload"/>
</span>

<button onclick="lowNote()">Send lowest MIDI note</button><span id="midiLow">min = 0</span>
<button onclick="highNote()">Send highest MIDI note</button><span id="midiHigh">max = 127</span>

<canvas id="glcanvas" width="1280px" height="720px">
    No <code>&lt;canvas&gt;</code> suppport in your browser.
</canvas>

</body>